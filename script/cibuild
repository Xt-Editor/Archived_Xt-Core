#!/bin/bash

if [[ -v "${TRAVIS_BUILD_DIR}" ]]; then
    export WORK_DIR="${TRAVIS_BUILD_DIR}"
elif [[ -v "${WORKSPACE}" ]]; then
    export WORK_DIR="${WORKSPACE}"
else
    echo "Unknown workspace."
    exit 1
fi

set -eu

echo "${WORK_DIR}"

# shellcheck source=/dev/null
. "${PWD}/script/utils.sh"

export PATH="$WORK_DIR/.local/bin:$PATH"
export PATH="$HOME/.cargo/bin:$PATH"

# Run the `check` Makefile target
echo -e "${GREEN}INFO:${RESET} Building project.."
gradle build

echo -e "${GREEN}INFO:${RESET} Testing project.."
gradle test

exit
