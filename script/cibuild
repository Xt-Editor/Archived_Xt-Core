#!/bin/bash

if [[ -n "${TRAVIS_BUILD_DIR}" ]]; then
    export WORK_DIR="${TRAVIS_BUILD_DIR}/rust"
else
    echo "Unknown workspace."
    exit 1
fi

set -eu

export PATH="$HOME/.cargo/bin:$PATH"

if [[ "${TRAVIS_RUST_VERSION}" == "nightly" && \
          "${CLIPPY}" ]]; then \
    cargo clippy
fi

cd "${WORK_DIR}" 

make ci-check

exit
