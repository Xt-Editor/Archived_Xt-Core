#!/bin/bash

if [[ -n "${TRAVIS_BUILD_DIR}" ]]; then
    export WORK_DIR="${TRAVIS_BUILD_DIR}"
elif [[ -n "${WORKSPACE}" ]]; then
    export WORK_DIR="${WORKSPACE}"
else
    echo "Unknown workspace."
    exit 1
fi

set -eu

# shellcheck source=/dev/null
. "${PWD}/script/utils.sh"

export PATH="$WORK_DIR/.local/bin:$PATH"
export PATH="$HOME/.cargo/bin:$PATH"

# Run the `check` Makefile target
echo -e "${GREEN}INFO:${RESET} Building project.."
./gradlew build

echo -e "${GREEN}INFO:${RESET} Testing project.."
./gradlew test

exit
