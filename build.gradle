defaultTasks 'all'

project.ext {
  version = '0.1.0'
  targetDir = './target'
}

task clean(type: Delete) {
  logger.info('Cleaning up..')
  
  delete(project.targetDir)

  doLast {
    println("Flushed away old files..")
  }
}

task bench(type: Exec) {
  mustRunAfter("test")
  logger.info("Running Cargo benchmarks..")
  
  commandLine('cargo', 'bench')
}

task build(type: Exec) {
  logger.info('Building with Cargo...')

  commandLine('cargo', 'build')
}

task test(type: Exec) {
  mustRunAfter("build")
  logger.info('Testing with Cargo...')

  commandLine('cargo', 'test')
}

task doc(type: Exec) {
  mustRunAfter("bench")
  logger.info("Generating documentation..")

  commandLine('cargo', 'doc')
}

task all {
  dependsOn build
}
